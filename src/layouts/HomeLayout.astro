---
import Layout from './Layout.astro';
import { getHomepageSchemas } from '../lib/homepage-schemas';
import type { Props as LayoutProps } from './Layout.astro';

// Re-export Layout props
export interface Props extends LayoutProps {}

const props = Astro.props;

// Get base URL for schema generation
export const isProduction = process.env.CONTEXT === 'production';
export const isDeployPreview = process.env.CONTEXT === 'deploy-preview';
const baseURL = isDeployPreview
  ? process.env.DEPLOY_PRIME_URL || Astro.site
  : Astro.site;
const canonicalURL = new URL(Astro.url.pathname, baseURL);

// Generate homepage schemas (Organization + WebSite + WebPage)
const [organizationSchema, websiteSchema, webpageSchema] =
  await getHomepageSchemas(baseURL, canonicalURL);

// Combine with any existing additionalSchemas
const allSchemas = [
  { schema: organizationSchema },
  { schema: websiteSchema },
  { schema: webpageSchema },
  ...(props.additionalSchemas || []),
];
---

<Layout {...props} additionalSchemas={allSchemas}>
  <slot />
</Layout>

