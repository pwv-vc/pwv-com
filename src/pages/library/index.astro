---
import Layout from '../../layouts/Layout.astro';
import '../../styles/global.css';
import {
  getAllLibraryPosts,
  getExternalLibraryPosts,
  getNonExternalLibraryPosts,
} from '../../lib/library';
import PostsGrid from '../../components/PostsGrid.astro';
import LibraryToggle from '../../components/LibraryToggle.astro';
import FeaturedPosts from '../../components/FeaturedPosts.astro';

const library = await getAllLibraryPosts();
const externalPosts = await getExternalLibraryPosts();
const nonExternalPosts = await getNonExternalLibraryPosts();

const filter = Astro.url.searchParams.get('filter') ?? 'all';
const activeFilter: 'all' | 'community' | 'pwv' = ['community', 'pwv'].includes(
  filter
)
  ? (filter as 'community' | 'pwv')
  : 'all';

const posts =
  activeFilter === 'community'
    ? externalPosts
    : activeFilter === 'pwv'
      ? nonExternalPosts
      : library;
---

<Layout>
  <div class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
    <div class="mb-12">
      <h1
        class="mb-4 text-2xl font-bold text-[var(--pwv-blue)] md:text-3xl lg:text-4xl"
      >
        Insights and thoughts
      </h1>
      <p class="text-lg text-gray-600">
        Insights, thoughts, and perspectives from PWV, our founders and
        community.
      </p>
    </div>

    <LibraryToggle
      externalCount={externalPosts.length}
      nonExternalCount={nonExternalPosts.length}
      activeFilter={activeFilter}
    />

    {activeFilter === 'all' && <FeaturedPosts />}

    <PostsGrid posts={posts} size="large" />
    <div class="mt-8 text-center">
      <a
        href="/"
        class="inline-flex items-center gap-2 font-medium text-neutral-600 transition-colors hover:text-neutral-700"
      >
        Back to Home
        <svg
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"></path>
        </svg>
      </a>
    </div>
  </div>
</Layout>
