---
import { type CollectionEntry, getCollection } from 'astro:content';
import { render } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import PlaceholderImage from '../../components/PlaceholderImage.astro';

// if Netlify output is server, then *must* be true
// export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection('library');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}
type Props = CollectionEntry<'library'>;

const post = Astro.props;
const { Content } = await render(post);
---
<Layout>
  <div class="prose prose-lg max-w-none">
    {post.data.heroImage ? (
      <Image
        src={post.data.heroImage}
        alt={post.data.title}
        class="w-full h-64 object-cover rounded-lg mb-8"
        loading="eager"
      />
    ) : (
      <PlaceholderImage
        alt={`Hero image for ${post.data.title}`}
        class="w-full h-64 rounded-lg mb-8"
      />
    )}

    <Content />
  </div>
</Layout>
