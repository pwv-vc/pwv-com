---
import { getCollection } from 'astro:content';
import TestimonialCard from './TestimonialCard.astro';

const testimonials = await getCollection('testimonials');
const sortedTestimonials = testimonials.sort((a, b) => {
  // Sort by quote length (shorter first) to get better top alignment
  const lengthA = a.data.quote.length;
  const lengthB = b.data.quote.length;
  if (lengthA !== lengthB) {
    return lengthA - lengthB;
  }
  // If same length, sort by name
  return a.data.name.localeCompare(b.data.name);
});
---

<section id="testimonials" class="my-8">
  <h2 class="text-primary my-4 mb-8 font-serif text-2xl font-bold lg:text-3xl">
    What Founders Say About Us
  </h2>

  <!-- Responsive Grid Layout -->
  <div
    class="border-default bg-surface-muted my-4 grid grid-cols-1 gap-6 rounded-lg border p-4 shadow-lg md:grid-cols-2 lg:grid-cols-3"
  >
    {
      sortedTestimonials.map((testimonial) => (
        <TestimonialCard
          name={testimonial.data.name}
          title={testimonial.data.title}
          company={testimonial.data.company}
          quote={testimonial.data.quote}
          url={testimonial.data.url}
          companySlug={testimonial.data['company-slug']}
        />
      ))
    }
  </div>
</section>
