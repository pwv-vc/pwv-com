---
import { getCollection } from 'astro:content';
import Heading2 from './Heading2.astro';
import TestimonialCard from './TestimonialCard.astro';

const testimonials = await getCollection('testimonials');
const sortedTestimonials = testimonials.sort((a, b) => {
  // Sort by quote length (shorter first) to get better top alignment
  const lengthA = a.data.quote.length;
  const lengthB = b.data.quote.length;
  if (lengthA !== lengthB) {
    return lengthA - lengthB;
  }
  // If same length, sort by name
  return a.data.name.localeCompare(b.data.name);
});
---

<section
  id="testimonials"
  class="bg-pwv-light-yellow mx-auto my-8 p-4 sm:px-6 lg:px-8"
>
  <Heading2>What Founders Say About Us</Heading2>

  <!-- Responsive Grid Layout -->
  <div class="my-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
    {
      sortedTestimonials.map((testimonial) => (
        <TestimonialCard
          name={testimonial.data.name}
          title={testimonial.data.title}
          company={testimonial.data.company}
          quote={testimonial.data.quote}
          url={testimonial.data.url}
          companySlug={testimonial.data['company-slug']}
        />
      ))
    }
  </div>
</section>
