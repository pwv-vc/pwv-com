---
import { getCollection } from 'astro:content';
import TestimonialCard from './TestimonialCard.astro';

const testimonials = await getCollection('testimonials');
const sortedTestimonials = testimonials.sort((a, b) => {
  // Sort by quote length (shorter first) to get better top alignment
  const lengthA = a.data.quote.length;
  const lengthB = b.data.quote.length;
  if (lengthA !== lengthB) {
    return lengthA - lengthB;
  }
  // If same length, sort by name
  return a.data.name.localeCompare(b.data.name);
});
---

<section id="testimonials" class="my-8 p-4 bg-neutral-50 rounded-lg border border-gray-200">
  <h2 class="text-2xl lg:text-3xl font-bold my-4 text-[var(--pwv-blue)] font-serif mb-8">What Founders Say About Us</h2>

  <!-- Responsive Grid Layout -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 my-4">
    {sortedTestimonials.map((testimonial) => (
      <TestimonialCard
        name={testimonial.data.name}
        title={testimonial.data.title}
        company={testimonial.data.company}
        quote={testimonial.data.quote}
        url={testimonial.data.url}
        companySlug={testimonial.data['company-slug']}
      />
    ))}
  </div>
</section>
