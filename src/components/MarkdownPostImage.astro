---
import { Image as UnpicImage } from '@unpic/astro';

interface Props {
  src?: any;
  path?: string; // relative to src/images, e.g. "startup-as-a-service/startup-as-a-service.001.jpeg"
  alt: string;
  size?: 'sm' | 'md' | 'lg' | 'full';
  rounded?: boolean;
  shadow?: boolean;
  class?: string;
  loading?: 'eager' | 'lazy';
}

const {
  src,
  path,
  alt,
  size = 'full',
  rounded = true,
  shadow = false,
  class: className = '',
  loading = 'lazy',
} = Astro.props as Props;

const heightMap: Record<string, string> = {
  sm: 'h-32',
  md: 'h-48',
  lg: 'h-64',
  full: 'h-auto',
};

const baseClasses = [
  'w-full',
  heightMap[size] ?? heightMap.md,
  'object-cover',
  rounded ? 'rounded-lg' : '',
  shadow ? 'shadow' : '',
  className,
]
  .filter(Boolean)
  .join(' ');

let resolvedSrc: string;
if (path) {
  const images = import.meta.glob('../images/library/**/*', {
    eager: true,
    import: 'default',
  }) as Record<string, any>;
  const key = `../images/library/${path}`;
  const found = images[key];
  resolvedSrc = typeof found === 'string' ? found : (found?.src ?? found);
} else {
  resolvedSrc =
    typeof src === 'object' && src !== null
      ? ((src as any).src ?? (src as any))
      : (src as string);
}
---

<div class="mx-auto w-full md:w-full lg:w-2/3">
  <UnpicImage
    src={resolvedSrc}
    alt={alt}
    class={baseClasses}
    loading={loading}
  />
</div>
